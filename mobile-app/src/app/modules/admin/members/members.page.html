<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goToDashboard()">
        <ion-icon name="home" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-menu-button></ion-menu-button>
      
    </ion-buttons>
    <ion-title>Miembros</ion-title>
    
    <ion-buttons slot="end">
      <ion-button (click)="refreshData()">
        <ion-icon name="refresh" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando miembros...</p>
  </div>

  <!-- Error -->
  <div *ngIf="!loading && errorMessage" class="error-container">
    <ion-icon name="alert-circle" color="danger" size="large"></ion-icon>
    <h3>Error</h3>
    <p>{{errorMessage}}</p>
    <ion-button (click)="refreshData()" fill="outline">
      Reintentar
    </ion-button>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !errorMessage">
    <!-- Search -->
    <ion-searchbar 
      placeholder="Buscar por nombre, teléfono..."
      (ionInput)="searchClient($event)"
      animated
      class="ion-padding">
    </ion-searchbar>

    <!-- Status Filter -->
    <ion-segment value="all" (ionChange)="filterByStatus($event)" class="ion-padding-horizontal">
      <ion-segment-button value="all">
        <ion-label>Todos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="activo">
        <ion-label>Activos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="inactivo">
        <ion-label>Inactivos</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- Stats Card -->
    <ion-card class="ion-margin">
      <ion-card-content>
        <div class="stats-container">
          <div class="stat-item">
            <h3>{{clients.length}}</h3>
            <p>Total</p>
          </div>
          <div class="stat-item">
            <h3>{{totalActivos}}</h3>
            <p>Activos</p>
          </div>
          <div class="stat-item">
            <h3>{{totalPorVencer}}</h3>
            <p>Por vencer</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Clients List -->
    <ion-list>
      <ion-item *ngFor="let client of filteredClients" button (click)="viewMemberDetails(client.usuario_id)">
        <ion-avatar slot="start">
          <ion-icon name="person-circle" *ngIf="!client.foto" size="large"></ion-icon>
          <img [src]="client.foto" *ngIf="client.foto" alt="Foto">
        </ion-avatar>
        
        <ion-label>
          <h2>
            {{client.nombre}} {{client.apellido}}
            <ion-badge [color]="getStatusColor(client.estado_cuota)" style="margin-left: 8px;">
              {{client.estado_cuota}}
            </ion-badge>
          </h2>
          
          <!-- WhatsApp Link -->
          <p class="whatsapp-link">
            <a 
              [href]="generarEnlaceWhatsApp(client)" 
              target="_blank"
              (click)="$event.stopPropagation()"
              class="whatsapp-number">
              <ion-icon name="logo-whatsapp" color="success"></ion-icon>
              {{client.telefono || 'Sin teléfono'}}
            </a>
          </p>
          
          <!-- Dates -->
          <p class="dates">
            <ion-icon name="calendar" size="small"></ion-icon>
            Insc: {{formatDate(client.fecha_inscripcion)}}
            • 
            Vence: {{formatDate(client.fecha_vencimiento)}}
            
            <ion-badge 
              color="warning" 
              *ngIf="diasParaVencer(client.fecha_vencimiento) <= 7 && diasParaVencer(client.fecha_vencimiento) > 0"
              style="margin-left: 8px;">
              Vence en {{diasParaVencer(client.fecha_vencimiento)}} días
            </ion-badge>
          </p>
        </ion-label>
        
        <ion-buttons slot="end" (click)="$event.stopPropagation()">
          <!-- WhatsApp Button -->
          <ion-button 
            fill="clear" 
            color="success"
            [href]="generarEnlaceWhatsApp(client)"
            target="_blank">
            <ion-icon name="logo-whatsapp" slot="icon-only"></ion-icon>
          </ion-button>
          
          <!-- View Button -->
          <ion-button fill="clear">
            <ion-icon name="eye" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-list>

    <!-- Empty State -->
    <div *ngIf="filteredClients.length === 0" class="empty-state">
      <ion-icon name="people-outline" size="large" color="medium"></ion-icon>
      <h3>No se encontraron miembros</h3>
      <p *ngIf="searchTerm || filterStatus !== 'all'">Intenta con otros filtros</p>
      <ion-button (click)="goToNewMember()" fill="solid" color="primary">
        <ion-icon name="add" slot="start"></ion-icon>
        Nuevo Miembro
      </ion-button>
    </div>
  </div>
</ion-content>

<!-- Floating Button -->
<ion-fab vertical="bottom" horizontal="end" slot="fixed">
  <ion-fab-button (click)="goToNewMember()">
    <ion-icon name="add"></ion-icon>
  </ion-fab-button>
</ion-fab>